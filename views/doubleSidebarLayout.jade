doctype html
html
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0')
    title #{title} | CPSC 319
    
    meta(property="og:site_name",content="")
    meta(property="og:title",content="")
    meta(property="og:description",content="")
    meta(property="og:image",content="")
    meta(property="og:url",content="")
    meta(property="og:type",content="website")
    
    meta(name="HandheldFriendly",content="True")
    
    != css('main')
    != css('styles')
    != js('application')
      
    block pageStyle
     
  body(class='#{ pageStyleVar }').pageStyle-sidebarViewLeft.pageStyle-sidebarViewRight
    
    include partials/navbar
    include partials/flash
    
    
    script.
      $(function() {   
        //- off-canvas sidebar toggle button
        function toggleClickSidebar(){
          //-$('#sidebarViewRight').toggleClass('col-xs-11').toggleClass('col-xs-10');
          //-$('#sidebarViewRight').toggleClass('col-sm-offset-1').toggleClass('col-xs-offset-2');
          //-$('#sidebarViewLeft').toggleClass('col-xs-1').toggleClass('col-xs-5');
          $('#sidebarViewLeft').toggleClass('sidebarWidthBounds');
          $('[data-toggle=offcanvas]').toggleClass('visible-xs text-center');
          $('[data-toggle=offcanvas]').find('i').toggleClass('fa-chevron-right fa-chevron-left');
          $('#lg-menu').toggleClass('hidden-xs').toggleClass('visible-xs');
          $('#xs-menu').toggleClass('visible-xs').toggleClass('hidden-xs');
        }
         
        //- CLOSE sidebar by clicking on content part of screen
        function closeSidebar(){
          $('#sidebarViewLeft').removeClass('sidebarWidthBounds');
          $('[data-toggle=offcanvas]').removeClass('text-center').addClass('visible-xs');
          $('[data-toggle=offcanvas]').find('i').removeClass('fa-chevron-left').addClass('fa-chevron-right');
          $('#lg-menu').addClass('hidden-xs').removeClass('visible-xs');
          $('#xs-menu').addClass('visible-xs').removeClass('hidden-xs');
        }
        
        $('[data-toggle=offcanvas]').click(function() {
          toggleClickSidebar();
        });
        
        
        //- Clashes with the Click event. This is problamatic because phones need to click on charts to view specific data points.
        /*$(window).swipe( {
          swipeLeft:function() {
            // IF MENU IS OPEN
            closeSidebar();
          },
          threshold:120
        });*/
        
        $('#sidebarViewLeft').swipe( {
          swipeRight:function() {
            closeSidebar();
            toggleClickSidebar();
          },
          threshold:10
        });
        
        $('#wrap, #footer').click(function(){
          closeSidebar();
        });
        
        $(window).resize(function(){
          closeSidebar();
        });
  
      })
  
  
  
    include partials/sidebar
            
    #sidebarViewRight.column.col-sm-10.col-xs-11.col-sm-offset-2.col-xs-offset-1
        .factorsBar.col-xs-2
          form(method='POST')
            input(type='hidden', name='_csrf', value=_csrf)
            if factors
              for factor in factors
                if factor
                  .form-group
                    label.control-label(for=factor.shortName)=factor.shortName
                    input.form-control(type='number', name=factor.shortName, data-from=factor.weight)&attributes(factor)

          script.
            $('input[type="number"]').ionRangeSlider({
                min: 0,
                max: 100,
                hide_min_max: true,
                type: 'single',
                grid: false,
                onFinish: rangeChange
            });
            function rangeChange(){
              var factors=[];
              $('input[type="number"]').each(function(index, element) {
                  factors.push(
                    {
                      shortName: element.name,
                      weight: $(element).data().from,
                      analyze: ((typeof( $(element).attr('analyze') ) != 'undefined')? true:false),
                      field: ((typeof( $(element).attr('field') ) != 'undefined')? $(element).attr('field') : 'undefined')
                    }
                  );
              });
              $.post('/matrix/set-weights', {_csrf: '#{_csrf}', factors: factors });
              
            }
            
        .col-xs-10.col-xs-offset-2
          block content
  
  
